#!/usr/bin/env bash

set -e

export PLAN9=${PLAN9:-/usr/local/plan9}
ARGS=("-a")

tabstop=4
font=/mnt/font/AtkinsonHyperlegibleNext-Medium/16a/font,/mnt/font/AtkinsonHyperlegibleNext-Medium/32a/font
fixedfont=/mnt/font/BerkeleyMono-Medium/15a/font,/mnt/font/BerkeleyMono-Medium/30a/font

# setup our fonts
[ -n "$font" ] && ARGS+=("-f" "$font")
[ -n "$fixedfont" ] && ARGS+=("-F" "$fixedfont")

# setup screen geometry
[ -n "$GEOMETRY" ] && ARGS+=("-W" "$GEOMETRY")

arch=x86_64
if arch -arch arm64 date >/dev/null 2>&1; then
    arch=arm64
fi

# start plumber if not already running.
p9plumb start

arch -arch $arch acme "${ARGS[@]}"
unset ARGS
