#!/bin/bash

set -e

status()
{
    pid=$(/bin/ps ax | grep plumber | grep -v grep | awk '{print $1}')

    if [[ $pid ]]; then
		echo $pid
    fi
    unset pid
}

start()
{
    pid=$(status)	
    if [ ! $pid ]; then
        $PLAN9/bin/9 plumber
        return $?
    fi
    return 0
}

stop()
{
	pid=$(status)
	if [ $pid ]; then
		/bin/kill -9 $pid 2> /dev/null
	fi
	unset pid
	return $?
}


if [ ! -x $PLAN9/bin/plumber ]; then
	echo 2>&1 "Error: plumber does not exist, you might need to build $PLAN9"
	exit 1
fi

case $1 in
	start) 
		start;;
	stop) 
		stop;;
	status) 
		status;;
	restart)
		stop
		start;;
	*) 
		echo 2>&1 "p9plumb [start | stop | restart | status ]"
		exit 1;;
esac
